<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ariâ€™s Phonics â€” Play</title>
<meta name="theme-color" content="#5f7cf3" />
<style>
  :root{
    --bg:#0e1116;--ink:#eaf0ff;--muted:#9fb0cc;--brand:#5f7cf3;--ok:#00c07f;--no:#ff5a7a;
    --card:#141a20;--line:#1f2a3f;--shadow:0 10px 30px rgba(0,0,0,.35)
  }
  *{box-sizing:border-box}
  body{margin:0;background:radial-gradient(1200px 800px at 20% -10%,#1b2230 0%,var(--bg) 60%) fixed;color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
  .app{max-width:820px;margin:0 auto;padding:18px}
  header{display:flex;align-items:center;justify-content:space-between;gap:10px}
  h1{margin:10px 0;font-size:clamp(20px,3.5vw,28px)}
  .card{background:linear-gradient(180deg,#141a24,#111620);border:1px solid var(--line);border-radius:18px;padding:14px;box-shadow:var(--shadow)}
  .row{display:grid;grid-template-columns:1fr;gap:14px}
  .big{font-size:clamp(64px,14vw,140px);font-weight:900;line-height:.9;letter-spacing:1px;background:linear-gradient(180deg,#fff,#d9e3ff);-webkit-background-clip:text;background-clip:text;color:transparent;text-shadow:0 12px 28px rgba(0,0,0,.5)}
  .imgwrap{display:grid;place-items:center;background:#0f1420;border:1px solid #1f2838;border-radius:16px;min-height:220px;padding:12px}
  .imgwrap img{width:100%;max-width:360px;height:auto;border-radius:12px}
  .word{font-size:28px;font-weight:800;letter-spacing:.4px;margin:6px 0 2px}
  .hint{color:var(--muted);font-size:14px}
  .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  .btn{padding:12px 14px;border-radius:12px;border:1px solid #26324b;background:#121a2a;color:var(--ink);font-weight:800;cursor:pointer;box-shadow:var(--shadow);transition:.2s transform,.2s background}
  .btn:active{transform:scale(.98)}
  .btn.primary{background:linear-gradient(180deg,#6b87ff,#546cee);border-color:#4f66db;color:#08102a}
  .btn.ok{background:linear-gradient(180deg,#03d192,#00b37a);border-color:#00a972;color:#071a14}
  .btn.no{background:linear-gradient(180deg,#ff7892,#ff5a7a);border-color:#ff3b63;color:#2b0010}
  .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:6px;margin-top:10px}
  .chip{padding:8px 0;text-align:center;border-radius:10px;background:#0b1018;border:1px solid #1a2232;font-weight:800;letter-spacing:.4px}
  .chip.active{outline:2px solid var(--brand);background:#111a2a}
  .board{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
  .tile{background:#0f1521;border:1px solid #223049;border-radius:14px;padding:10px;display:grid;place-items:center;min-height:110px;cursor:pointer;transition:.2s transform,.2s background}
  .tile.correct{background:#0f1f1a;border-color:#186a4c}
  .tile img{max-width:100%;max-height:96px}
  .wordchip{font-weight:900;padding:10px;border-radius:12px;border:1px dashed #2b3a56;background:#10192a;text-align:center}
  .progress{height:10px;border-radius:999px;background:#101726;border:1px solid #223149;overflow:hidden}
  .bar{height:100%;background:linear-gradient(90deg,#6b87ff,#00b37a)}
  footer{margin:16px 0 30px;text-align:center;color:var(--muted);font-size:12px}
</style>
</head>
<body>
<div class="app">
  <header>
    <h1>Ariâ€™s Phonics</h1>
    <div style="min-width:160px">
      <div class="progress"><div id="bar" class="bar" style="width:0%"></div></div>
      <div class="hint" id="unlockHint" style="text-align:right;margin-top:4px"></div>
    </div>
  </header>

  <div id="stage" class="card">
    <div id="learnView">
      <div style="display:grid;grid-template-columns:auto 1fr auto;align-items:center;gap:10px">
        <button class="btn" id="prevBtn">â¬…ï¸Ž</button>
        <div id="big" class="big">A</div>
        <button class="btn" id="nextBtn">âž¡ï¸Ž</button>
      </div>
      <div class="imgwrap" style="margin-top:10px"><img id="pic" alt=""></div>
      <div id="word" class="word">apple</div>
      <div id="hint" class="hint">/a/ as in apple</div>
      <div class="controls">
        <button class="btn primary" id="sayBtn">ðŸ”Š Say it</button>
        <button class="btn" id="playBtn">â–¶ï¸Ž Play</button>
      </div>
      <div id="grid" class="grid"></div>
    </div>

    <div id="quizView" style="display:none">
      <div class="imgwrap" style="margin-bottom:10px"><img id="qImg" alt=""></div>
      <div id="qWord" class="word">b_t</div>
      <div class="hint" id="qHint">Which letter is missing? Listenâ€¦</div>
      <div id="choices" class="board" style="margin-top:10px"></div>
      <div class="controls">
        <button class="btn" id="hearBtn">ðŸ”Š Hear sound</button>
        <button class="btn" id="keepPlayingBtn">Next</button>
      </div>
    </div>
  </div>

  <footer>Images: Openclipart (public domain) â€¢ Voice: browser SpeechSynthesis (en-AU)</footer>
</div>

<script>
/* ========= MEDIA (public-domain images) ========= */
const PD = {
  A:[{word:"apple", img:"https://openclipart.org/image/400px/293547"}],
  B:[{word:"boat", img:"https://openclipart.org/image/400px/243014"}],          // boat (extra you asked for)
  C:[{word:"cat", img:"https://openclipart.org/image/400px/175527"}],
  D:[{word:"dolphin", img:"https://openclipart.org/image/400px/242629"}],       // dolphin (extra)
  E:[{word:"egg", img:"https://openclipart.org/image/400px/251621"}],
  F:[{word:"fish", img:"https://openclipart.org/image/400px/223934"}],
  G:[{word:"goat", img:"https://openclipart.org/image/400px/302996"}],          // replaced goat
  H:[{word:"hat", img:"https://openclipart.org/image/300px/svg_to_png/179201"}],
  I:[{word:"igloo", img:"https://openclipart.org/image/300px/svg_to_png/320635"}],
  J:[{word:"jam", img:"https://openclipart.org/image/300px/svg_to_png/246736"}],
  K:[{word:"kite", img:"https://openclipart.org/image/300px/svg_to_png/311549"}],
  L:[{word:"lion", img:"https://openclipart.org/image/400px/197954"}],          // replaced lion
  M:[{word:"moon", img:"https://openclipart.org/image/400px/150367"}],
  N:[{word:"nest", img:"https://openclipart.org/image/400px/177776"}],
  O:[{word:"owl", img:"https://openclipart.org/image/400px/17566"}],
  P:[{word:"pig", img:"https://openclipart.org/image/400px/201651"}],
  Q:[{word:"queen", img:"https://openclipart.org/image/300px/svg_to_png/246737"}],
  R:[{word:"ring", img:"https://openclipart.org/image/400px/229221"}],
  S:[
    {word:"shark", img:"https://openclipart.org/image/400px/220514"},          // shark (extra)
    {word:"swim", img:"https://openclipart.org/image/400px/217684"}            // swim (extra)
  ],
  T:[{word:"train", img:"https://openclipart.org/image/300px/svg_to_png/301321"}], // train (extra)
  U:[{word:"umbrella", img:"https://openclipart.org/image/400px/103813"}],
  V:[{word:"van", img:"https://openclipart.org/image/400px/283135"}],
  W:[{word:"whale", img:"https://openclipart.org/image/400px/257334"}],
  X:[{word:"xylophone", img:"https://openclipart.org/image/400px/280532"}],
  Y:[{word:"yarn", img:"https://openclipart.org/image/400px/178389"}],
  Z:[{word:"zebra", img:"https://openclipart.org/image/400px/223129"}]
};
const LETTERS = Object.keys(PD); // A..Z

/* ========= Progress & Unlocks ========= */
const START = ["A","R","I"];
const UNLOCK_ORDER = ["M","S","T","P","N","E","O","U","L","C","D","G","H","K","B","F","J","Q","V","W","X","Y","Z"];
const TARGET_STREAK = 3;

function loadProgress(){
  let unlocked = JSON.parse(localStorage.getItem("unlockedLetters")||"null") || START.slice();
  let streaks  = JSON.parse(localStorage.getItem("streaks")||"null") || Object.fromEntries(START.map(L=>[L,0]));
  // ensure all unlocked have entries
  unlocked.forEach(L=>{ if(!(L in streaks)) streaks[L]=0; });
  return {unlocked, streaks};
}
function saveProgress(){
  localStorage.setItem("unlockedLetters", JSON.stringify(state.unlocked));
  localStorage.setItem("streaks", JSON.stringify(state.streaks));
}
const state = loadProgress();

/* ========= UI Elements ========= */
const big = document.getElementById("big"), pic = document.getElementById("pic"),
      wordEl = document.getElementById("word"), hint = document.getElementById("hint"),
      grid = document.getElementById("grid"), bar = document.getElementById("bar"),
      unlockHint = document.getElementById("unlockHint"),
      learnView = document.getElementById("learnView"), quizView = document.getElementById("quizView"),
      prevBtn = document.getElementById("prevBtn"), nextBtn = document.getElementById("nextBtn"),
      sayBtn = document.getElementById("sayBtn"), playBtn = document.getElementById("playBtn"),
      qImg = document.getElementById("qImg"), qWord = document.getElementById("qWord"),
      qHint = document.getElementById("qHint"), choices = document.getElementById("choices"),
      hearBtn = document.getElementById("hearBtn"), keepPlayingBtn = document.getElementById("keepPlayingBtn");

/* ========= Helpers ========= */
function speak(text, rate=0.95){
  try{ const u=new SpeechSynthesisUtterance(text); u.lang="en-AU"; u.rate=rate; speechSynthesis.cancel(); speechSynthesis.speak(u);}catch(e){}
}
function phonemeFor(letter){
  // simple: speak the letter quickly (phonics-like). For future: custom phoneme map.
  return letter.toLowerCase();
}
function choice(arr){ return arr[Math.floor(Math.random()*arr.length)]; }
function shuffle(a){ for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]} return a; }

/* ========= Learn view (visual + audio) ========= */
let currentIndex = 0; // index in state.unlocked
let currentExampleIndex = 0; // if a letter has multiple words (e.g., S)
function renderGrid(){
  grid.innerHTML="";
  LETTERS.forEach(L=>{
    const b=document.createElement("div");
    b.className="chip"+(state.unlocked.includes(L)?"":"");
    b.textContent=L;
    b.style.opacity = state.unlocked.includes(L) ? "1" : ".25";
    if(state.unlocked.includes(L)){
      b.onclick = ()=>{ currentIndex = state.unlocked.indexOf(L); currentExampleIndex=0; renderLearn(); };
    }
    grid.appendChild(b);
  });
}
function currentLetter(){ return state.unlocked[currentIndex % state.unlocked.length]; }
function currentExample(){
  const L = currentLetter();
  const list = PD[L];
  return list[(currentExampleIndex % list.length)];
}
function renderLearn(){
  const L = currentLetter();
  const ex = currentExample();
  big.textContent = L;
  wordEl.textContent = ex.word;
  hint.textContent = `/${phonemeFor(L)}/ as in ${ex.word}`;
  if (ex.img){ pic.src = ex.img; pic.style.opacity = "1"; }
  else { pic.removeAttribute("src"); pic.style.opacity="0"; }
  updateProgressUI();
}
prevBtn.onclick = ()=>{ currentIndex = (currentIndex - 1 + state.unlocked.length) % state.unlocked.length; currentExampleIndex=0; renderLearn(); };
nextBtn.onclick = ()=>{ currentIndex = (currentIndex + 1) % state.unlocked.length; currentExampleIndex=0; renderLearn(); };
sayBtn.onclick = ()=>{ const L=currentLetter(), w=currentExample().word; speak(`${L}. ${w}. ${L} says ${phonemeFor(L)}. ${w}.`, 0.95); };
playBtn.onclick = ()=> startQuizFlow();

/* ========= Quiz (missing letter) ========= */
let quizLetter = null; // the target letter for this round
function startQuizFlow(){
  quizLetter = pickQuizLetter(); // prefer letters under target streak
  const {word, img} = PD[quizLetter][0];
  const missPos = Math.max(0, word.indexOf(quizLetter.toLowerCase())); // try miss the target letter position if present
  const display = word.split("").map((c,i)=> i===missPos ? "_" : c).join("");
  qImg.src = img; qImg.alt = word; qWord.textContent = display;
  qHint.textContent = "Which letter is missing? Listenâ€¦";
  learnView.style.display = "none";
  quizView.style.display = "";
  makeChoices(quizLetter);
  // audio cue: just the phoneme
  setTimeout(()=>speak(phonemeFor(quizLetter), 0.9), 150);
}
function pickQuizLetter(){
  // First try letters with streak < TARGET_STREAK
  const need = state.unlocked.filter(L => (state.streaks[L]||0) < TARGET_STREAK);
  if (need.length) return choice(need);
  return choice(state.unlocked);
}
function makeChoices(correctLetter){
  // 3 options: correct + 2 random distinct others
  let opts = new Set([correctLetter.toLowerCase()]);
  while (opts.size < 3){
    const c = String.fromCharCode(97 + Math.floor(Math.random()*26));
    opts.add(c);
  }
  opts = shuffle([...opts]);
  choices.innerHTML = "";
  opts.forEach(l=>{
    const t=document.createElement("div");
    t.className="tile"; t.textContent=l;
    t.onclick = ()=> onPick(l, correctLetter.toLowerCase(), t);
    choices.appendChild(t);
  });
}
hearBtn.onclick = ()=> speak(phonemeFor(quizLetter), 0.9);

function onPick(sel, correct, el){
  if (sel === correct){
    el.classList.add("correct");
    speak("Well done!", 1.0);
    const L = quizLetter;
    state.streaks[L] = (state.streaks[L]||0) + 1;
    saveProgress();
    maybeUnlockNext();
    // continue to next learn card
    keepPlayingBtn.disabled = false;
  } else {
    el.style.background = "#2a1420";
    el.style.borderColor = "#79314c";
    speak("Try again", 1.0);
    // reset streak for that letter
    state.streaks[quizLetter] = 0;
    saveProgress();
  }
}
keepPlayingBtn.onclick = ()=>{
  // After a correct answer, go back to learn with a new letter
  quizView.style.display = "none";
  learnView.style.display = "";
  // advance to a letter that still needs practice if possible
  const need = state.unlocked.filter(L => (state.streaks[L]||0) < TARGET_STREAK);
  if (need.length){
    currentIndex = state.unlocked.indexOf(choice(need));
  } else {
    currentIndex = (currentIndex + 1) % state.unlocked.length;
  }
  currentExampleIndex = 0;
  renderLearn();
};

/* ========= Unlock logic ========= */
function allCurrentMastered(){
  return state.unlocked.every(L => (state.streaks[L]||0) >= TARGET_STREAK);
}
function maybeUnlockNext(){
  if (!allCurrentMastered()) { updateProgressUI(); return; }
  // find next not-yet-unlocked in order
  const next = UNLOCK_ORDER.find(L => !state.unlocked.includes(L));
  if (next){
    state.unlocked.push(next);
    state.streaks[next] = 0;
    saveProgress();
    // gentle celebration
    speak(`${next}! New letter unlocked!`, 0.95);
    currentIndex = state.unlocked.indexOf(next);
    currentExampleIndex = 0;
    renderGrid();
    renderLearn();
  }
  updateProgressUI();
}
function updateProgressUI(){
  const mastered = state.unlocked.filter(L => (state.streaks[L]||0) >= TARGET_STREAK).length;
  const pct = Math.round(100 * mastered / Math.max(1, state.unlocked.length));
  bar.style.width = pct + "%";
  const remainingInSet = state.unlocked.length - mastered;
  const nextLetter = UNLOCK_ORDER.find(L => !state.unlocked.includes(L));
  unlockHint.textContent = remainingInSet>0
    ? `${remainingInSet} to master â†’ unlock`
    : (nextLetter ? `Next unlock: ${nextLetter}` : `All letters unlocked`);
}

/* ========= Boot ========= */
function preload(){
  Object.values(PD).flat().forEach(ex=>{ if(ex.img){ const i=new Image(); i.src=ex.img; } });
}
function ensureStreakEntries(){
  state.unlocked.forEach(L=>{ if(!(L in state.streaks)) state.streaks[L]=0; });
  saveProgress();
}
function firstRun(){
  // if this is truly first run, set unlocked to A,R,I and streaks 0
  if (!localStorage.getItem("unlockedLetters")){
    state.unlocked = START.slice();
    state.streaks = Object.fromEntries(START.map(L=>[L,0]));
    saveProgress();
  }
}
document.getElementById("keepPlayingBtn").disabled = true;
firstRun(); ensureStreakEntries(); renderGrid(); renderLearn(); preload();

</script>
</body>
</html>
